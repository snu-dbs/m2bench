Select count(*) from (Select brands.name as brand_name,  product_name, percent_of_revenue From (    Select brand_id, product_name, percent_of_revenue, $D as brands From     (     Select brand_id, product_name, (order_price/$C.revenue[0]) as percent_of_revenue From             (                     SELECT brand_id, product_name, brand_id, order_price, $C FROM $B     Let $B = (SELECT brand_id, product_name, A.order_price as order_price     From     (SELECT brand_id,  product_id, title as product_name,     (SELECT product_id, sum(price) as order_price     From (SELECT order_line.product_id as product_id, order_line.price as price     From (SELECT *           From Order     Where order_date >= "2020-06-01" and order_date <= "2021-06-01"     UNWIND order_line))     Group by product_id) as A     From Product     UNWIND A)     Where A.product_id == product_id),     $C = (Select brand_id as top_brand, sum(order_price) as revenue From $B Group by brand_id Order by revenue DESC limit 1)     UNWIND $C     )     Where brand_id == $C.top_brand     Order by percent_of_revenue         )     LET $D = (Select brand_id, name from Brand)     unwind brands     )     where brands.brand_id = brand_id )
